<html>
<head>
  <title>Flows chat test page</title>
  <script src="/socket.io/socket.io.js"></script>
  <%- js "chat.js" %>
  <script>
    var room;
    
    var opts = {
      url: "http://" + window.location.hostname + ":" + window.location.port + "/chat",
      onError: function (err) {
        document.getElementById("content").innerHTML+="Error: " + err + "</br>";
      },
      onJoined: function (data) {
        room = data;
        document.getElementById("chatroom").innerHTML = data;
        document.getElementById("content").innerHTML+="Successfully joined " + data + " chat room.<br/>";
      },
      onLeft: function (data) {
        room = undefined;
        document.getElementById("chatroom").innerHTML = "undefined";
        document.getElementById("content").innerHTML+="Successfully left " + data + " chat room.<br/>";
      },
      onNick: function (nickname) {
        document.getElementById("nickname").innerHTML = nickname;
        document.getElementById("content").innerHTML+="Nickname set to: " + nickname + "</br>";
      },
      onChat: function(msg) {
        document.getElementById("content").innerHTML+="Chat event: " + JSON.stringify(msg) + "</br>";
      }
    };

    var chat = new Chat(opts);

    function nickBox() {
      var nick = document.getElementById('nickTxt').value;
      chat.requestNickname(nick);
    }

    function joinBox() {
      if (room) {
        chat.onError("This demo is limited to a single chat room..");
        return;
      }
      var data = document.getElementById('joinTxt').value;
      if (data===room) {
        chat.onError("You have already joined that room!");
      }
      chat.joinRoom(data); 
    }

    function leaveBox() {
      var data = document.getElementById('joinTxt').value;
      chat.leaveRoom(data); 
    }

    function chatBox() {
      var msg = document.getElementById('chatTxt').value;
      chat.say(room, msg);
    }
  </script>
</head>
<body>
  <h1>Flows chat test</h1>

  <p>Your nickname is: <b><span id="nickname">unset</span></b></p>
  <p>Your chatroom is: <b><span id="chatroom">unset</span></b></p>

  <p>Set a nickname:</p>
  <form>
    <input type="text" id="nickTxt">
    <input type="button" onClick="nickBox()" value="Set!">
  </form>

  <p>Join a chat room:</p>
  <form>
    <input type="text" id="joinTxt">
    <input type="button" onClick="joinBox()" value="Join!">
    <input type="button" onClick="leaveBox()" value="Leave!">
  </form>

  <p>Say something:</p>
  <form>
    <input type="text" id="chatTxt">
    <input type="button" onClick="chatBox()" value="Say!">
  </form>
  <p id="content">Waiting..<br/></p>
</body>
</html>
